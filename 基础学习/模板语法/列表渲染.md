# 列表渲染

使用`v-for`指令可以基于数组或对象渲染一个列表。数据源可以是数组/对象/范围值（一个数字）

语法：

- `v-for=(item in items)`：items 表示源数据，item 表示迭代项的别名。
- `v-for=(item of items)`：使用 of 效果同上

可以把`v-for`理解为`items.forEach(item=>dosomething)`，和 forEach 回调的入参一样，**第二个参数**是索引。并且迭代项支持解构语法。

**v-for 与作用域**
v-for 内部的块可以访问完整的父级作用域。同样可以类比`forEach`回调函数的作用域。对于多级嵌套的 v-for，同样适用这个规则。
在被修饰的元素上，其他指令同样可以使用该作用域内的对象（除了`v-if`，`v-if`的优先级更高）。

## v-for 和 v-if 的作用域

我们通常说 v-if 比 v-for 优先级更高。
可以理解为模板引擎会先处理 v-if，形成一个**块级作用域**，然后在这个作用域中再处理 v-for，因此 v-if 是无法访问到 v-for 中的定义的变量的。
当我们有需求想要反转这种作用域关系，可以借助`template`元素，把 v-for 指令提升到父级元素上。

```html
<template v-for="item in items">
  <li v-if="item.show">{{item.value}}</li>
</template>
```

## v-for 与对象

v-for 并不要求源数据必须是一个可迭代对象，同样可以是一个对象，迭代顺序和`Object.values()`的返回顺序相同，我们也能从中推断出模板引擎内部就是
利用这个函数把对象值转换成了一个可迭代对象，因此此时`v-for=((value,key,index) in obj)`中的迭代项就是 value，第二个参数则是 key，第三个参数是索引。

## v-for 与范围值

`v-for=(num in 10)`表示迭代 10 次。注意这里是从 1 开始，到 n 结束。

## template 上的 v-for

和`v-for`相同，当想同时重复多个元素时，可以用`template`包裹所有的目标元素，在`template`上使用`v-for`。

## v-for 与 key

首先我们要了解 vue 的默认渲染策略，那就是`就地更新`。指的是**复用**当前位置的元素，改变其属性或者内容。在列表渲染时，假如我交换了两个元素的位置，此时默认情况下，元素的状态并不会跟着被交换，这在动态表单中经常会遇到。
此时我们就需要用到`key`属性，`key`的作用是提示 vue 这个元素的标识，便于在位置交换时重用元素。

`key`是通过`v-bind`绑定的一个特殊属性，不会传递到子组件中。

参考[Vue 渲染策略](../../列表渲染策略.md)

## 在组件上使用 v-for

组件上使用 v-for 和在一般元素上规则相同。但是不会自动传递数据到组件中，可以理解为函数的作用域只与定义时的词法环境有关，与在何处调用无关。传递数据时同样可以使用`v-bind`

## 侦测数组变化

vue 能监听到以下几种情况下的响应式数组变更

- 使用能改变数组本身的 API，例如`splice`,`reverse`,`push`
- 直接替换数组，即`refArr.value = newArr`。

在需要使用例如`filter`,`slice`等不改变原数组的 API 对数组进行过滤时，推荐使用`计算属性`。

在计算属性中，慎用会改变数组本身的 API，因为计算属性的回调应该是一个**纯函数**，不应该产生副作用，如果要使用，请先**复制数组**（如果数组中的元素是引用类型，同样要注意）
