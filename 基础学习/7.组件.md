# 组件

- 组件注册
- 组件的生命周期
- 组件间的交互：Props/透传 Attributes/事件/slot/依赖注入
- 组件间数据双向绑定的语法糖：v-model
- 动态组件
- 异步组件

## 组件注册

组件在使用前都要注册，有两种方式注册组件。

- 全局注册
- 局部注册

全局注册的缺点

- 组件之间的依赖关系变得不那么明确和容易定位。
- 无法进行 tree shaking。

### 全局注册

全局注册的组件在使用时无需 import。
注意，必须在 mount 之前完成注册。

```javascript
import { createApp } from "vue";

const app = createApp({});

app.component(
  // 注册的名字
  "MyComponent",
  // 组件的实现,可以是通过import引入的组件定义
  {
    /* ... */
  }
);
```

### 局部注册

在 script setup 中 import 的组件会被自动注册，如果没有使用 script setup，那么就需要在选项中指定。局部注册的组件仅在当前组件中可用，后代组件中不可用。

### 组件名

组件名注册时一般都是大驼峰的形式。在 template 中使用时，组件名也建议使用大驼峰的形式，便于和原生的 html 元素做区分。但是 vue 模板中是支持不同格式的组件名的，在编译和执行时会进行兼容处理。
但是在 DOM 内的模板不能使用大驼峰的形式，因为 html 对于元素名是不区分大小写的，因此建议使用短横线连接的方式。

支持的格式：

- 短横线连接：例如`my-component`
- 大驼峰：例如`MyComponent`
- 小驼峰：虽然官方文档中没有提到且不推荐，但是其兼容实现支持这种写法。`myComponent`

## 组件的生命周期

组件在每个生命周期阶段都会运行对应生命周期钩子函数，通过对这些钩子函数的注册可以介入这些阶段。

几个经常被干预的生命周期：

- setup：这是组件在初始化之前进行的准备阶段，我们在 script setup 中编写的代码就是在这个阶段被执行。
- mounte：对应`onMounted`，在这个阶段，真实 DOM 已经挂载完成并可以访问了。想要干预挂载之前的阶段可以使用`onBeforeMounte`
- update：对应`onUpdated`，在这个阶段，组件已经更新完成，更新前的阶段使用`onBeforeUpdate`
- unmount：对应`onUnmounted`，在这个阶段，组件已经完成了卸载，用于做一些清理工作。卸载之前的阶段使用`onBeforeUnmount`

借用官网的图
![生命周期图](./img/生命周期.png)

**钩子函数有如下限制**

- 必须在 setup 阶段**同步**进行注册，意思是在 setup 的调用栈中完成注册，不能异步进行注册，因为 setup 调用栈被销毁的话，钩子函数无法访问到组件实例，因此无法完成注册。

## 组件间的交互

- props：数据属性，子组件显示声明，父组件在元素的属性列表中传入，模板中可以通过`$props`访问对应的属性
- 事件：事件属性，子组件显示声明，父组件在元素的属性列表中传入，模板中可以通过`$emit`触发对应的事件
- 透传 Attributes：子组件声明的所有数据属性和事件属性，模板中可以通过`$attrs`访问
- slot：插槽，父组件元素的内容模板，子组件可以通过 slot 元素访问
- 依赖注入：用于远距离组件间的交互，父组件通过`provide`函数暴露需要共享的数据，子组件通过`inject`函数注入共享数据

> [Props 详解](./组件/Props.md)；
> [事件 详解](./组件/事件.md)；
> [透传属性详解](./组件/透传Attributes.md)；
> [依赖注入详解](./组件/依赖注入.md)；
> [插槽详解](./组件/插槽slot.md)；
